<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Módulo A1 - Elementary | Inglês no seu Ritmo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../enhanced-styles.css">
</head>
<body class="bg-gray-100 text-gray-800">

    <header class="bg-white shadow-sm sticky top-0 z-40">
        <div class="container mx-auto px-6 py-4">
            <div class="flex justify-between items-center mb-4">
                <a href="../aluno.html" class="text-lg font-bold text-purple-600 hover:text-purple-800 flex items-center gap-2 transition-colors">
                    <i class="fas fa-chevron-left"></i> Voltar ao Portal
                </a>
                <h1 id="header-title" class="text-2xl font-bold text-gray-700 text-center">Module A1</h1>
                <div class="w-40 hidden md:block"></div>
            </div>
            
            <div id="progress-container" class="w-full bg-gray-200 rounded-full h-4 relative overflow-hidden">
                <div id="progress-bar" class="bg-purple-600 h-4 rounded-full transition-all duration-500 ease-out"></div>
                <span id="progress-text" class="absolute inset-0 text-center text-xs font-bold text-white leading-4">0/32</span>
            </div>
        </div>
    </header>

    <main class="container mx-auto p-4 sm:p-8 mt-4">
        <div id="lessons-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
            <p id="loading-text" class="text-center col-span-full text-gray-500 text-lg">Carregando sua jornada de aprendizado...</p>
        </div>
    </main>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ... (Seu código de configuração do Firebase permanece o mesmo) ...
            const firebaseConfig = {
                apiKey: "AIzaSyA4srp5nACEhOLLD8Yd4cwe5_rZ8izcm1Y",
                authDomain: "inglesnoseuritmo-bae14.firebaseapp.com",
                projectId: "inglesnoseuritmo-bae14",
                storageBucket: "inglesnoseuritmo-bae14.appspot.com",
                messagingSenderId: "112615489735",
                appId: "1:112615489735:web:9ee215ab9a2246f3a13ee2"
            };

            if (!firebase.apps.length) {
                firebase.initializeApp(firebaseConfig);
            }
            const db = firebase.firestore();
            const auth = firebase.auth();

            const headerTitle = document.getElementById('header-title');
            const gridContainer = document.getElementById('lessons-grid');
            const loadingText = document.getElementById('loading-text');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            
            const lessons = [
                 { id: 1, title: "Hello, World!" }, { id: 2, title: "Where Are You From?" }, { id: 3, title: "My World" }, { id: 4, title: "The Alphabet and Numbers" }, { id: 5, title: "Contact Information" }, { id: 6, title: "Everyday Objects" }, { id: 7, title: "This or That?" }, { id: 8, title: "Review & Practice (Module 1)" }, { id: 9, title: "My Daily Routine" }, { id: 10, title: "His/Her Routine" }, { id: 11, title: "Do You Like Music?" }, { id: 12, title: "I Don't Like That" }, { id: 13, title: "He helps me (Object Pronouns)" }, { id: 14, title: "How Often?" }, { id: 15, title: "What Time Is It?" }, { id: 16, title: "Review & Practice (Module 2)" }, { id: 17, title: "My uncle's car (Possessives)" }, { id: 18, title: "My Job" }, { id: 19, title: "My House" }, { id: 20, title: "Where Is the Bank?" }, { id: 21, title: "How much / How many?" }, { id: 22, title: "A little / A few" }, { id: 23, title: "Can / Can't" }, { id: 24, title: "What Are You Doing?" }, { id: 25, title: "Simple Present vs. Continuous" }, { id: 26, title: "Review & Practice (Module 3)" }, { id: 27, "title": "Where Were You Born?" }, { id: 28, title: "What Did You Do Yesterday?" }, { id: 29, title: "Questions in the Past" }, { id: 30, title: "Plans for the Future" }, { id: 31, title: "A1 Final Review" }, { id: 32, title: "Final Project & Next Steps" }
            ];

            function renderLessons(completedLessons, role = 'aluno') {
                gridContainer.innerHTML = '';
                
                const progressPercentage = (completedLessons.length / lessons.length) * 100;
                progressBar.style.width = `${progressPercentage}%`;
                progressText.textContent = `${completedLessons.length}/${lessons.length}`;

                let nextLessonId = -1;
                if (role === 'aluno') {
                    const firstUncompleted = lessons.find(l => !completedLessons.includes(l.id));
                    if (firstUncompleted) {
                        nextLessonId = firstUncompleted.id;
                    }
                }

                lessons.forEach(lesson => {
                    const lessonNumberStr = String(lesson.id).padStart(2, '0');
                    const lessonUrl = `licao-${lessonNumberStr}.html`;

                    let status = 'locked';
                    let statusIcon = '<i class="fas fa-lock text-gray-400"></i>';
                    let buttonText = 'Bloqueada';
                    let buttonClass = 'bg-gray-400 cursor-not-allowed';
                    let linkHref = '#';
                    let clickHandler = 'onclick="event.preventDefault();"';
                    let cardClasses = 'lesson-card--locked';

                    if (role === 'professor' || completedLessons.includes(lesson.id)) {
                        status = 'completed';
                        statusIcon = '<i class="fas fa-check-circle text-green-500"></i>';
                        buttonText = 'Revisar';
                        buttonClass = 'bg-green-600 hover:bg-green-700';
                        linkHref = lessonUrl;
                        clickHandler = '';
                        cardClasses = 'lesson-card--completed';
                    }
                    
                    if (role === 'aluno' && lesson.id === nextLessonId) {
                        status = 'next';
                        statusIcon = '<i class="fas fa-play-circle text-purple-500"></i>';
                        buttonText = 'Começar';
                        buttonClass = 'bg-purple-600 hover:bg-purple-700 shadow-lg';
                        linkHref = lessonUrl;
                        clickHandler = '';
                        cardClasses = 'lesson-card--next';
                    }

                    const cardHtml = `
                        <div class="lesson-card ${cardClasses}">
                            <div class="flex-grow">
                                <div class="flex items-start justify-between mb-3">
                                    <span class="lesson-number">Lição ${lesson.id}</span>
                                    <span class="lesson-status-icon">${statusIcon}</span>
                                </div>
                                <h3 class="lesson-title">${lesson.title}</h3>
                            </div>
                            <a href="${linkHref}" ${clickHandler} class="lesson-button ${buttonClass}">
                                ${buttonText}
                            </a>
                        </div>`;
                    gridContainer.innerHTML += cardHtml;
                });
            }

            auth.onAuthStateChanged(async (user) => {
                // ... (Sua lógica de autenticação e busca de dados permanece a mesma) ...
                if (!user) { window.location.href = '../login.html'; return; }
                const role = localStorage.getItem('loggedInUserRole') || 'aluno';
                const studentId = (role === 'professor') ? localStorage.getItem('selectedStudentId') : user.uid;
                if (!studentId) { loadingText.innerHTML = '<p class="text-red-500">Erro: Aluno não identificado.</p>'; return; }

                try {
                    const studentDoc = await db.collection("students").doc(studentId).get();
                    if (!studentDoc.exists) { loadingText.textContent = 'Aluno não encontrado.'; return; }
                    const studentData = studentDoc.data();
                    const progress = studentData.progress?.a1 || {};
                    const completedLessons = Object.keys(progress).map(key => parseInt(key.replace('lesson_', '')));
                    headerTitle.textContent = `Módulo A1 - ${studentData.name}`;
                    renderLessons(completedLessons, role);
                } catch (error) {
                    console.error("Erro:", error);
                    loadingText.textContent = 'Ocorreu um erro ao carregar o progresso.';
                }
            });
        });
    </script>
</body>
</html>