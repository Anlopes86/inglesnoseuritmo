<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal do Aluno - Inglês no seu ritmo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../enhanced-styles.css">
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
</head>
<body class="bg-gray-100 font-sans">

    <div id="loading-message" class="flex items-center justify-center h-screen text-center text-gray-600 p-8 text-xl">
        <i class="fas fa-spinner fa-spin mr-3"></i>Carregando portal do aluno...
    </div>

    <div id="portal-container" class="hidden">
        
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2 class="text-2xl font-bold text-white">Inglês no seu Ritmo</h2>
            </div>
            <nav class="sidebar-nav">
                <a href="#dashboard-section" class="nav-link active"><i class="fas fa-home nav-icon"></i> Dashboard</a>
                <a href="#progress-section" class="nav-link"><i class="fas fa-chart-line nav-icon"></i> Meu Progresso</a>
                <a href="#badges-section" class="nav-link"><i class="fas fa-trophy nav-icon"></i> Emblemas</a>
                <a href="#notes-section" class="nav-link"><i class="fas fa-pencil-alt nav-icon"></i> Anotações</a>
                <a href="#tools-section" class="nav-link"><i class="fas fa-atom nav-icon"></i> Ferramentas IA</a>
            </nav>
            <div class="sidebar-footer">
                <a href="../index.html" id="back-to-index-btn" class="hidden items-center justify-center gap-2 text-gray-300 hover:text-white font-semibold py-2 px-4 rounded-lg hover:bg-gray-700 transition w-full">
                    <i class="fas fa-arrow-left"></i> Voltar ao Painel
                </a>
                <div id="logout-btn-container" class="w-full"></div>
            </div>
        </aside>

        <main id="main-content" class="main-content">
            <header id="welcome-header" class="mb-6 p-6 bg-white rounded-2xl shadow-sm">
                <h1 id="header-title" class="text-3xl md:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 via-purple-600 to-teal-600">Welcome, <span id="student-name-welcome">...</span>!</h1>
                <p id="header-subtitle" class="text-gray-500 text-lg mt-1">Let's make some progress today.</p>
            </header>

            <div id="portal-content">
                
                <section id="dashboard-section" class="page-section">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="lg:col-span-2 space-y-8">
                            <div id="last-lesson-card" class="enhanced-card p-8 bg-gradient-to-br from-purple-600 to-blue-600 text-white shadow-xl rounded-2xl flex flex-col md:flex-row items-center gap-8"></div>
                            <div id="challenge-card" class="enhanced-card p-8 bg-white rounded-2xl shadow-sm">
                                <h2 class="text-2xl font-bold mb-4 flex items-center gap-3"><i class="fas fa-bolt text-yellow-500"></i> Desafio Rápido</h2>
                                <p id="daily-challenge-question" class="text-lg text-gray-700 mb-4">Carregando...</p>
                                <div class="flex flex-col sm:flex-row gap-3">
                                    <input type="text" id="daily-challenge-answer" class="enhanced-input flex-grow" placeholder="Sua resposta...">
                                    <button id="daily-challenge-submit" class="enhanced-btn bg-gray-800 text-white px-6">Verificar</button>
                                    <button id="new-challenge-btn" title="Novo Desafio" class="enhanced-btn bg-blue-500 text-white px-4"><i class="fas fa-sync-alt"></i></button>
                                </div>
                                <p id="challenge-feedback" class="text-sm mt-2 h-4 font-semibold"></p>
                                <div id="challenge-tips-container" class="mt-4 text-sm text-left" style="display: none;">
                                    <a href="#" id="show-tips-btn" class="text-blue-600 font-semibold hover:underline"><i class="fas fa-lightbulb mr-1"></i> Precisa de uma dica?</a>
                                    <div id="challenge-tips-text" class="hidden mt-2 p-3 bg-blue-50 border border-blue-200 rounded-lg text-blue-800"></div>
                                </div>
                            </div>
                            <div id="expression-card" class="enhanced-card p-8 bg-white rounded-2xl shadow-sm">
                                 <h2 class="text-2xl font-bold mb-4 flex items-center gap-3"><i class="fas fa-comment-dots text-purple-500"></i> Expressão da Lição</h2>
                                 <div id="expression-card-content"></div>
                            </div>
                        </div>
                        <div class="space-y-8">
                            <div id="modules-card" class="enhanced-card p-8 bg-gray-800 text-white rounded-2xl shadow-lg flex flex-col justify-center items-center text-center"></div>
                            <div id="next-badge-card" class="enhanced-card p-6 bg-white rounded-2xl shadow-sm">
                                <h3 class="text-lg font-bold mb-3 flex items-center gap-3"><i class="fas fa-flag-checkered text-indigo-500"></i> Sua Próxima Conquista</h3>
                                <div id="next-badge-content" class="flex items-center gap-4">
                                    <div id="next-badge-icon" class="text-5xl text-gray-300"></div>
                                    <div class="flex-grow">
                                        <p id="next-badge-text" class="text-gray-700 font-medium">Carregando...</p>
                                        <div class="w-full bg-gray-200 rounded-full h-2.5 mt-2"><div id="next-badge-progress-bar" class="bg-gradient-to-r from-indigo-500 to-purple-600 h-2.5 rounded-full" style="width: 0%"></div></div>
                                    </div>
                                </div>
                            </div>
                            <div class="enhanced-card p-6 bg-white rounded-2xl shadow-sm space-y-6">
                                <div id="schedule-card">
                                    <h3 class="text-lg font-bold mb-2 flex items-center gap-3"><i class="fas fa-calendar-check text-green-500"></i> Próxima Aula</h3>
                                    <div id="schedule-card-content"></div>
                                </div>
                                <hr>
                                <div id="focus-card">
                                    <h3 class="text-lg font-bold mb-2 flex items-center gap-3"><i class="fas fa-crosshairs text-blue-500"></i> Foco da Semana</h3>
                                    <div id="focus-card-content"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="progress-section" class="page-section hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div id="progress-card-a1" class="enhanced-card p-6 text-center" style="display: none;"></div>
                        <div id="progress-card-conversation" class="enhanced-card p-6 text-center" style="display: none;"></div>
                        <div id="grades-card-a1" class="enhanced-card p-6" style="display: none;"></div>
                    </div>
                </section>

                <section id="badges-section" class="page-section hidden"><div id="badges-card-a1" class="enhanced-card p-6" style="display: none;"></div><div id="badges-card-conversation" class="enhanced-card p-6 mt-6" style="display: none;"></div></section>
                <section id="notes-section" class="page-section hidden"><div id="notes-card" class="enhanced-card p-6"></div></section>
                <section id="tools-section" class="page-section hidden"><div class="space-y-8"><div class="grid grid-cols-1 md:grid-cols-2 gap-8"><div id="ai-review-card" class="enhanced-card p-8 bg-gray-700 text-white flex flex-col rounded-2xl"></div><div id="ai-preview-card" class="enhanced-card p-8 bg-teal-600 text-white flex flex-col rounded-2xl"></div></div><div class="enhanced-card p-8"><h3 class="text-2xl font-bold mb-4 text-center">Sua Biblioteca de Prompts</h3><p class="text-center text-gray-600 mb-6">Reveja os prompts de qualquer lição que você já completou.</p><div id="prompt-library-accordion"></div></div></div></section>
            </div>
        </main>
    </div>
    
    <div id="badge-modal" class="modal-overlay hidden">
        <div class="modal-content text-center max-w-md w-full">
            <div class="badge-modal-content">
                <div id="badge-modal-icon"></div>
                <h2 id="badge-modal-title" class="badge-title"></h2>
                <div id="badge-modal-message"></div>
            </div>
            <button id="close-badge-modal-btn" class="mt-6 enhanced-btn bg-gray-800 text-white w-full py-3">Fechar</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="../js/firebase-config.js"></script>
    <script src="../js/prompt-database.js"></script>
    <script src="../js/aluno-notes.js"></script>
    <script src="../js/aluno-portal.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const navLinks = document.querySelectorAll('.nav-link');
            const pageSections = document.querySelectorAll('.page-section');
            const headerTitle = document.getElementById('header-title');
            const headerSubtitle = document.getElementById('header-subtitle');
            let studentName = '...'; 
            
            const sectionInfo = {
                'dashboard-section': { title: () => `Welcome, <span id="student-name-welcome" class="text-transparent bg-clip-text bg-gradient-to-r from-blue-600 via-purple-600 to-teal-600">${studentName}</span>!`, subtitle: "Let's make some progress today." },
                'progress-section': { title: () => 'Meu Progresso', subtitle: 'Acompanhe sua evolução detalhada no curso.' },
                'badges-section': { title: () => 'Jornada de Emblemas', subtitle: 'Todas as conquistas que você desbloqueou.' },
                'notes-section': { title: () => 'Minhas Anotações', subtitle: 'Suas notas pessoais de cada lição.' },
                'tools-section': { title: () => 'Ferramentas de IA', subtitle: 'Turbine seus estudos com inteligência artificial.' }
            };

            function updateView(targetId) {
                navLinks.forEach(link => link.classList.toggle('active', link.getAttribute('href') === `#${targetId}`));
                pageSections.forEach(section => section.classList.toggle('hidden', section.id !== targetId));
                const newInfo = sectionInfo[targetId];
                if (newInfo) {
                    headerTitle.innerHTML = newInfo.title();
                    headerSubtitle.textContent = newInfo.subtitle;
                }
                 window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            navLinks.forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    updateView(targetId);
                });
            });

            const observer = new MutationObserver((mutations, obs) => {
                const nameSpan = document.getElementById('student-name-welcome');
                if (nameSpan && nameSpan.textContent && nameSpan.textContent.trim() !== '...') {
                    studentName = nameSpan.textContent.trim();
                    document.getElementById('loading-message').style.display = 'none';
                    document.getElementById('portal-container').classList.remove('hidden');
                    
                    // MUDANÇA: Corrigido de '#dashboard-section' para 'dashboard-section'
                    updateView('dashboard-section'); 
                    
                    if (typeof inicializarAnotacoes === 'function') inicializarAnotacoes();
                    obs.disconnect();
                }
            });

            observer.observe(document.body, { childList: true, subtree: true });
        });
    </script>
</body>
</html>